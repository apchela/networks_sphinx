.. _create-vps:

Как настроить VPS-сервер
========================

*******************
1. Выбор провайдера
*******************

Лучше всего выбирать ближайшую локацию сервера — будет выше скорость работы.
Для легких проектов будет достаточно 1 ГБ ОЗУ объема RAM и CPU.
Обязательно наличие SSH-доступа, обычно он включен по умолчанию.

**************
2. Регистрация
**************

* Создать новый сервер (обычно кнопки *Create Droplet*, *New Instance* или *Create Server*).
* Выбрать операционную систему — самая стабильная и популярная Ubuntu 22.04 LTS.
* Указать размер (например, 1vCPU, 1GB RAM — достаточно для тестов).
* Добавить свой :ref:`SSH-ключ <create-ssh>`.
* Создать сервер.

*******************************
3. Подключение к серверу по :ref:`SSH <create-ssh>`
*******************************

* Добавить публичный ключ на VPS-сервер для user.

* Ввести команду в терминале::

    ssh root@<IP_сервера>

После входа под root-правами нужно сделать первичную настройку:

* Обновить пакеты::

    apt update && apt upgrade -y

* Добавить нового пользователя (чтобы не работать напрямую от root)::

    adduser user


* Задать пароль и подтвердить. Дать права администратора::

    usermod -aG sudo admin


****************************************
4. Настроить :ref:`SSH <create-ssh>` для нового пользователя
****************************************

1. Открыть :ref:`SSH-конфигурацию <create-ssh>`::

    sudo nano /etc/ssh/sshd_config

2. Найти и изменить/добавить следующие параметры:

* Меняем стандартный порт (например, на 22222)::

   Port 22222

* Запрещаем вход под root::

   PermitRootLogin no

* В `/etc/ssh/sshd_config` разрешаем вход только по ключу (без пароля)::

   PasswordAuthentication no
   PubkeyAuthentication yes

* Разрешаем только нашего пользователя (опционально)::

   AllowUsers user

* Перезапустить :ref:`SSH <create-ssh>`::

    sudo systemctl restart ssh

.. important::

    Теперь вход будет возможен только по ключу от пользователя user.

* Проверить соединение. Выйти из сервера (exit) и подключиться заново::

    ssh admin@<IP_сервера>

Если все работает — значит, сервер готов к использованию.